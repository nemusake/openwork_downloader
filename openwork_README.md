# OpenWork データ取得ツール

OpenWorkのウェブサイトから企業データを自動取得し、CSV形式で保存するPython3スクリプトです。

## 概要

OpenWorkの企業分析ページから以下のデータを取得します：
- クチコミ総合評価
- 待遇面の満足度
- 社員の士気
- 風通しの良さ
- 社員の相互尊重
- 20代成長環境
- 人材の長期育成
- 法令順守意識
- 人事評価の適正感
- 有給休暇消化率
- 残業時間(月間)

各指標について2016年～2025年の10年分のデータを取得します。

## ファイル構成

```
openwork/
├── openwork.py                     # 単一企業データ取得スクリプト
├── openwork_batch.py              # 一括データ取得スクリプト
├── openwork_list.csv              # 企業リストファイル
├── data/                          # 出力CSVファイル格納フォルダ
│   ├── 1301_極洋_Small2_a0910000000Fqdi.csv
│   ├── 1332_ニッスイ_Mid400_a0910000000Fqdk.csv
│   └── ...
├── claude.md                      # プロジェクト設定
├── sow.md                         # 作業範囲定義書
├── openwork_README.md             # このファイル
└── 使用手順書_openwork.md          # 詳細な使用手順
```

## 技術仕様

### 開発環境
- **言語**: Python 3
- **ライブラリ**: 標準ライブラリのみ使用（ポータビリティ重視）
  - `urllib.request`: HTTP通信
  - `re`: 正規表現
  - `json`: JSONパース
  - `csv`: CSV読み書き

### データ取得方式
1. 企業のanalysisページにHTTPリクエスト
2. HTMLから`function getData()`のJSONデータを正規表現で抽出
3. 指定した11項目のみをフィルタリング
4. データを正規化してCSV形式で出力

### 出力形式
#### ファイル名
`コード_銘柄名_ニューインデックス区分_企業コード.csv`

例: `1301_極洋_Small2_a0910000000Fqdi.csv`

- **ニューインデックス区分の処理**: 
  - TOPIXプレフィックスを除去（例: `TOPIX Small 2` → `Small 2`）
  - 空白を除去（例: `Small 2` → `Small2`）

#### CSV構造
```csv
date,銘柄名,コード,ニューインデックス区分,企業コード,年,指標名,スコア
2025/6/30,極洋,1301,TOPIX Small 2,a0910000000Fqdi,2016,クチコミ総合評価,2.85
2025/6/30,極洋,1301,TOPIX Small 2,a0910000000Fqdi,2017,クチコミ総合評価,2.84
...
```

- **正規化形式**: 各年・各指標が1行
- **UTF-8 BOM付き**: 日本語対応、データベース保存に適した形式
- **110行/企業**: 11指標 × 10年分のデータ
- **ニューインデックス区分**: TOPIX分類情報を含む（TOPIX Small 2、TOPIX Mid400等）

## 負荷軽減対策

- **リクエスト間隔**: 3秒間隔で実行
- **User-Agent設定**: 適切なブラウザ識別子を設定
- **タイムアウト設定**: 30秒でタイムアウト

## エラーハンドリング

- ネットワークエラー時の自動スキップ
- データ抽出失敗時のログ出力
- 個別企業の失敗が全体に影響しない設計

## 使用例

### 単一企業データ取得
```bash
python3 openwork.py a0910000000Fqdi
```

### 一括データ取得
```bash
python3 openwork_batch.py
```

## 入力ファイル形式

`openwork_list.csv`は以下の形式で作成してください：

```csv
date,銘柄名,コード,業種,TOPIXに占める個別銘柄のウエイト,ニューインデックス区分,URL
2025/6/30,極洋,1301,水産・農林業,0.000067,TOPIX Small 2,https://www.openwork.jp/a0910000000Fqdi/analysis/
```

## 制限事項

- 社員クチコミ数が不足している企業では一部データが取得できない場合があります
- 最新年度（2024-2025年）のデータが`null`の場合があります
- サーバー負荷軽減のため、大量データの取得には時間がかかります

## ライセンス

このツールは教育・研究目的で使用してください。商用利用時はOpenWorkの利用規約を確認してください。

## 履歴

- 2025年8月: 初版リリース
- データ取得項目を残業時間まで11項目に限定
- ファイル名形式を`コード_銘柄名_企業コード.csv`に変更
- 3秒間隔でのリクエスト制御を実装
- CSV出力にニューインデックス区分列を追加
- ファイル名にニューインデックス区分を追加（`コード_銘柄名_ニューインデックス区分_企業コード.csv`）